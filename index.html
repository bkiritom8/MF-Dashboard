<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Mutual Fund Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div id="pin-screen" class="pin-screen hidden">
    <div class="pin-box">
      <h2>Enter PIN</h2>
      <input id="pin-input" type="password" maxlength="4" placeholder="..." inputmode="numeric"/>
      <button onclick="checkPin()">Unlock</button>
      <p id="pin-error" class="pin-error hidden">Wrong PIN. Try again.</p>
    </div>
  </div>

  <div id="app" class="hidden">
    <header>
      <div class="header-left">
        <h1>My Mutual Funds</h1>
        <p id="last-updated" class="subtitle">Loading...</p>
      </div>
      <div class="header-right">
        <button class="btn-secondary" onclick="exportPortfolio()">Export</button>
        <label class="btn-secondary" style="cursor:pointer">Import
          <input type="file" accept=".json" onchange="importPortfolio(event)" style="display:none"/>
        </label>
        <button class="btn-primary" onclick="openAddFund()">+ Add Fund</button>
      </div>
    </header>

    <div id="summary-bar" class="summary-bar">
      <div class="summary-card"><span class="s-label">Total Invested</span><span class="s-value" id="total-invested">-</span></div>
      <div class="summary-card"><span class="s-label">Current Value</span><span class="s-value" id="total-current">-</span></div>
      <div class="summary-card"><span class="s-label">Dividends Received</span><span class="s-value positive" id="total-dividends">-</span></div>
      <div class="summary-card"><span class="s-label">Total Gain / Loss</span><span class="s-value" id="total-gain">-</span></div>
      <div class="summary-card highlight"><span class="s-label">Portfolio XIRR</span><span class="s-value" id="portfolio-xirr">-</span></div>
    </div>

    <div class="section-title">Your Funds</div>
    <div id="funds-grid" class="funds-grid"></div>

    <div class="section-title" style="margin-top:2rem">Compare Funds (up to 4)</div>
    <div class="compare-section">
      <div class="compare-search">
        <input id="compare-input" type="text" placeholder="Search and add a fund to compare..." oninput="searchCompare(this.value)"/>
        <div id="compare-dropdown" class="dropdown hidden"></div>
      </div>
      <div id="compare-chips" class="compare-chips"></div>
      <div id="compare-chart-wrap" class="chart-outer hidden">
        <div class="range-btns" id="compare-range-btns">
          <button class="range-btn" onclick="setCompareRange(30)">1M</button>
          <button class="range-btn" onclick="setCompareRange(90)">3M</button>
          <button class="range-btn" onclick="setCompareRange(180)">6M</button>
          <button class="range-btn" onclick="setCompareRange(365)">1Y</button>
          <button class="range-btn" onclick="setCompareRange(1095)">3Y</button>
          <button class="range-btn" onclick="setCompareRange(1825)">5Y</button>
          <button class="range-btn active" id="compare-all-btn" onclick="setCompareRange(0)">Common</button>
        </div>
        <div class="zoom-hint">Drag left-to-right to zoom in. Drag right-to-left or double-click to reset.</div>
        <div class="chart-wrap">
          <canvas id="compare-chart" height="280"></canvas>
          <div id="compare-tooltip" class="chart-tooltip hidden"></div>
        </div>
        <div id="compare-legend" class="compare-legend"></div>
      </div>
      <div id="compare-table" class="compare-result hidden"></div>
    </div>

    <div class="section-title" style="margin-top:2rem">Top Performing Funds</div>
    <div class="top-section">
      <div class="top-controls">
        <div class="control-group">
          <label>Category</label>
          <select id="top-category" onchange="loadTopFunds()">
            <option value="120">Large Cap</option>
            <option value="119">Mid Cap</option>
            <option value="118">Small Cap</option>
            <option value="117">Multi Cap</option>
            <option value="121">ELSS (Tax Saving)</option>
            <option value="122">Flexi Cap</option>
          </select>
        </div>
        <div class="control-group">
          <label>Time Period</label>
          <select id="top-period" onchange="loadTopFunds()">
            <option value="365">1 Year</option>
            <option value="1095" selected>3 Years</option>
            <option value="1825">5 Years</option>
          </select>
        </div>
      </div>
      <div id="top-results" class="top-results">
        <p class="top-loading">Loading top performers...</p>
      </div>
    </div>
  </div>

  <!-- Add Fund Modal -->
  <div id="modal" class="modal-overlay hidden">
    <div class="modal">
      <h3>Add Mutual Fund</h3>
      <div class="form-group">
        <label>Search Fund</label>
        <input id="fund-search" type="text" placeholder="e.g. Mirae Asset Large Cap" oninput="searchFund(this.value)"/>
        <div id="fund-dropdown" class="dropdown hidden"></div>
      </div>
      <div class="form-group"><label>Amount Invested (Rs.)</label><input id="fund-amount" type="number" placeholder="50000"/></div>
      <div class="form-group"><label>Purchase Date</label><input id="fund-date" type="date"/></div>
      <div class="form-group"><label>Units Held</label><input id="fund-units" type="number" step="0.001" placeholder="e.g. 120.5"/></div>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" onclick="addFund()">Add Fund</button>
      </div>
    </div>
  </div>

  <!-- NAV Chart Modal -->
  <div id="chart-modal" class="modal-overlay hidden">
    <div class="modal modal-wide">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;flex-wrap:wrap;gap:.5rem">
        <h3 id="chart-modal-title" style="font-size:1rem;max-width:75%">NAV History</h3>
        <button class="btn-secondary" onclick="closeChartModal()">Close</button>
      </div>
      <div class="range-btns" id="nav-range-btns">
        <button class="range-btn" onclick="setNavRange(30)">1M</button>
        <button class="range-btn" onclick="setNavRange(90)">3M</button>
        <button class="range-btn" onclick="setNavRange(180)">6M</button>
        <button class="range-btn" onclick="setNavRange(365)">1Y</button>
        <button class="range-btn" onclick="setNavRange(1095)">3Y</button>
        <button class="range-btn" onclick="setNavRange(1825)">5Y</button>
        <button class="range-btn active" onclick="setNavRange(0)">All</button>
      </div>
      <div class="zoom-hint">Drag left-to-right to zoom in. Drag right-to-left or double-click to reset.</div>
      <div class="chart-wrap" style="margin-top:.5rem">
        <canvas id="nav-chart" height="300"></canvas>
        <div id="nav-tooltip" class="chart-tooltip hidden"></div>
      </div>
      <div id="chart-signal" class="signal-box" style="margin-top:1rem"></div>
      <div id="chart-dividends" style="margin-top:1rem"></div>
    </div>
  </div>

  <script src="xirr.js"></script>
  <script src="app.js"></script>
</body>
</html>